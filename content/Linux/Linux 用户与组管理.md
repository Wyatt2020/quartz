---
created: 2023-10-26 14:23
modified: 2023-10-26 15:35
tags:
  - Linux
---

Linux 系统是一个多用户多任务的分时操作系统，任何一个要使用系统资源的用户，都必须首先向系统管理员申请一个账号，然后以这个账号的身份进入系统。

### 用户和用户组的相关文件

#### /etc/passwd

用户的配置文件，记录用户的各种信息

```
用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell
```

1. “用户名”是代表用户账号的字符串。

2. “口令”一些系统中，存放着加密后的用户口令字。
> 虽然这个字段存放的只是用户口令的加密串，不是明文，但是由于 `/etc/passwd` 文件对所有用户都可读，所以这仍是一个安全隐患。因此，现在许多 Linux 系统都使用了 `shadow` 技术，把真正的加密后的用户口令字存放到 `/etc/shadow` 文件中，而在 `/etc/passwd` 文件的口令字段中只存放一个特殊的字符，例如 `x` 或者 `*`。

3. “用户标识号”是一个整数，系统内部用它来标识用户。
> 一般情况下它与用户名是一一对应的。如果几个用户名对应的用户标识号是一样的，系统内部将把它们视为同一个用户，但是它们可以有不同的口令、不同的主目录以及不同的登录 Shell 等。
通常用户标识号的取值范围是 0～65535。0 是超级用户 `root` 的标识号，1～99 由系统保留，作为管理账号，普通用户的标识号从 100 开始。在 Linux 系统中，这个界限是 500。

4. “组标识号”字段记录的是用户所属的用户组。
> 它对应着 `/etc/group` 文件中的一条记录。

5. “注释性描述”字段记录着用户的一些个人情况。
> 例如用户的真实姓名、电话、地址等，这个字段并没有什么实际的用途。在不同的 Linux 系统中，这个字段的格式并没有统一。在许多 Linux 系统中，这个字段存放的是一段任意的注释性描述文字，用作 `finger` 命令的输出。

6. “主目录”，也就是用户的起始工作目录。
> 它是用户在登录到系统之后所处的目录。在大多数系统中，各用户的主目录都被组织在同一个特定的目录下，而用户主目录的名称就是该用户的登录名。各用户对自己的主目录有读、写、执行（搜索）权限，其他用户对此目录的访问权限则根据具体情况设置。

7. 用户登录后，要启动一个进程，负责将用户的操作传给内核，这个进程是用户登录到系统后运行的命令解释器或某个特定的程序，即 Shell。
> Shell 是用户与 Linux 系统之间的接口。Linux 的 Shell 有许多种，每种都有不同的特点。常用的有 sh(Bourne Shell), csh(C Shell), ksh(Korn Shell), tcsh(TENEX/TOPS-20 type C Shell), bash(Bourne Again Shell)等。
系统管理员可以根据系统情况和用户习惯为用户指定某个 Shell。如果不指定 Shell，那么系统使用 sh 为默认的登录 Shell，即这个字段的值为 `/bin/sh`。
用户的登录Shell也可以指定为某个特定的程序（此程序不是一个命令解释器）。
利用这一特点，我们可以限制用户只能运行指定的应用程序，在该应用程序运行结束后，用户就自动退出了系统。有些 Linux 系统要求只有那些在系统中登记了的程序才能出现在这个字段中。

8. 系统中有一类用户称为伪用户 (pseudo users)
> 这些用户在 `/etc/passwd` 文件中也占有一条记录，但是不能登录，因为它们的登录 Shell 为空。它们的存在主要是方便系统管理，满足相应的系统进程对文件属主的要求。
> 标准的伪用户有 `audit`, `cron`, `mail`, `usenet` 等。

#### /etc/shadow

`/etc/shadow` 中的记录行与 `/etc/passwd` 中的一一对应，它由 `pwconv` 命令根据 `/etc/passwd` 中的数据自动产生。

由于 `/etc/passwd` 文件是所有用户都可读的，如果用户的密码太简单或规律比较明显的话，一台普通的计算机就能够很容易地将它破解，因此对安全性要求较高的 Linux 系统都把加密后的口令字分离出来，单独存放在一个文件中，这个文件是 `/etc/shadow` 文件。有超级用户才拥有该文件读权限，这就保证了用户密码的安全性。

```
登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:保留
```

1. “登录名”是与 `/etc/passwd` 文件中的登录名相一致的用户账号
2. “口令”字段存放的是加密后的用户口令字，长度为13个字符。如果为空，则对应用户没有口令，登录时不需要口令；如果含有不属于集合 {`./0-9A-Za-z`}中的字符，则对应的用户不能登录。
3. “最后一次修改时间”表示的是从某个时刻起，到用户最后一次修改口令时的天数。时间起点对不同的系统可能不一样。例如在 SCO Linux 中，这个时间起点是 1970 年 1 月 1 日。
4. “最小时间间隔”指的是两次修改口令之间所需的最小天数。
5. “最大时间间隔”指的是口令保持有效的最大天数。
6. “警告时间”字段表示的是从系统开始警告用户到用户密码正式失效之间的天数。
7. “不活动时间”表示的是用户没有登录活动但账号仍能保持有效的最大天数。
8. “失效时间”字段给出的是一个绝对的天数，如果使用了这个字段，那么就给出相应账号的生存期。期满后，该账号就不再是一个合法的账号，也就不能再用来登录了。

#### /etc/group

用户组的所有信息都存放在 `/etc/group` 文件中。

将用户分组是 Linux 系统中对用户进行管理及控制访问权限的一种手段。

每个用户都属于某个用户组；一个组中可以有多个用户，一个用户也可以属于不同的组。

当一个用户同时是多个组中的成员时，在 `/etc/passwd` 文件中记录的是用户所属的主组，也就是登录时所属的默认组，而其他组称为附加组。

用户要访问属于附加组的文件时，必须首先使用 `newgrp` 命令使自己成为所要访问的组中的成员。

```
组名:口令:组标识号:组内用户列表
```

1. “组名”是用户组的名称，由字母或数字构成。与 `/etc/passwd` 中的登录名一样，组名不应重复。
2. “口令”字段存放的是用户组加密后的口令字。一般 Linux 系统的用户组都没有口令，即这个字段一般为空，或者是`*`。
3. “组标识号”与用户标识号类似，也是一个整数，被系统内部用来标识组。
4. “组内用户列表”是属于这个组的所有用户的列表，不同用户之间用逗号`,`分隔。这个用户组可能是用户的主组，也可能是附加组。

### 查看用户是否存在 id

```shell
id 用户名
```

### 查看登录用户信息 whoami

```shell
whoami
```

```shell
who am i
```

### 添加用户 useradd

```shell
useradd 选项 用户名
```

- `-c <注释>` 指定一段注释性描述
- `-d <目录>` 指定用户主目录，如果此目录不存在，则同时使用 `-m` 选项，可以创建主目录
- `-g <GID>` 指定用户所属的用户组，不指定会创建一个名称与用户名相同的组
- `-G <用户组>` 指定用户所属的附加组
- `-m` 用户主目录如不存在则自动建立
- `-s <Shell文件>` 指定用户的登录 Shell
- `-u <用户号>` 指定用户的用户号，如果同时有 `-o` 选项，则可以重复使用其他用户的标识号

### 设置普通用户具有 root 权限

修改配置文件

```shell
vi /etc/sudoers
```

添加配置，设置 `study` 用户具有 `root` 权限
```ini
study ALL=(ALL) ALL
```

或者配置成使用 `sudo` 命令时，不需要输入密码
```ini
study ALL=(ALL:ALL) NOPASSWD:ALL
```

解释：
- 第一段：用户名或者用户组，表示谁有权限来使用后面的配置。%sudo 代表 sudo 组下的所有用户
- 第二段：表示来源地，即从哪执行这条命令。ALL表示所有计算机
- 第三段：表示 sudo 可以切换到什么用户。ALL 表示所有用户
- 第四段：表示 sudo 可以切换到哪些组下的用户。ALL 表示所有组
- 第五段：表示 sudo 之后能够执行的命令。`NOPASSWD: ALL` 表示执行任意命令都不需要密码


### 修改用户 usermod

```shell
usermod 选项 用户名
```

选项同「添加用户」

### 设置口令 passwd

用户账号刚创建时没有口令，但是被系统锁定，无法使用，必须为其指定口令后才可以使用，即使是指定空口令

超级用户可以为自己和其他用户指定口令，普通用户只能用它修改自己的口令

```shell
passwd 用户名
```

- `-l` 锁定口令，禁用账号
- `-u` 解锁口令，解锁账号
- `-d` 使账号无口令，此命令将用户的口令删除，系统就不再允许该用户登录了
- `-f` 强迫用户下次登录时修改口令

### 切换用户 su

```shell
su 用户名
```

- `$` 表示普通用户
- `#` 表示超级用户，也就是 `root` 用户
- 从普通用户切换到 `root` 用户，可以使用命令：`sudo su`
- 在终端输入 `exit` 或 `logout` 或使用快捷方式 `ctrl+d`，可以退回到原来用户
- 在切换用户时，如果想在切换用户之后使用新用户的工作环境，可以在 `su` 和 `username` 之间加`-`，例如：`su - root`

### 删除用户 userdel

```shell
userdel 选项 用户名
```

常用的选项是 `-r`，把用户的主目录一起删除

### 添加用户组 groupadd

```shell
groupadd 选项 用户组
```

- `-g <GID>` 指定新用户组的组标识号（GID）。
- `-o` 一般与 `-g` 选项同时使用，表示新用户组的 GID 可以与系统已有用户组的 GID 相同

### 删除用户组 groupdel

```shell
groupdel 用户组
```

### 修改用户组 groupmod

```shell
groupmod 选项 用户组
```

- `-g <GID>` 指定新的组标识号
- `-o` 与 `-g` 选项同时使用，用户组的新 GID 可以与系统已有用户组的 GID 相同
- `-n 新用户组` 将用户组的名字改为新名字

### 切换用户组 newgrp

```shell
$ newgrp root
```

这条命令将当前用户切换到 `root` 用户组，前提条件是 `root` 用户组确实是该用户的主组或附加组
