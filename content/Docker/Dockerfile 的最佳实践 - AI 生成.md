---
created: 2024-04-27 23:27
modified: 2024-04-27 23:33
tags:
  - docker
---

> [!ai] 本文基于通义灵码的回答整理而成。

1. **使用官方基础镜像**：尽量使用 Docker Hub 上的官方镜像作为基础镜像，这些镜像维护良好，安全性较高，且更新及时。
2. **最小化基础镜像**：选择满足需求的最小基础镜像，以减小最终镜像的大小。例如，如果不需要完整的操作系统功能，可以选择 *Alpine Linux* 这样的轻量级发行版。
3. **多阶段构建**：利用 Dockerfile 的多阶段构建功能，可以将构建过程分为构建阶段和运行阶段。这样可以将构建工具、源代码等仅在构建时需要的内容与最终运行时镜像分开，有效减小最终镜像尺寸。
4. **减少层的数量**：每条 `RUN`, `COPY`, `ADD` 等指令都会创建一个新的镜像层。尽量合并命令以减少层数，例如，使用 `&&` 连接多条命令到一个 `RUN` 指令中，减少最终镜像的体积和构建时间。
5. **使用 COPY 而不是 ADD**：在 Dockerfile 中使用 `COPY` 命令而不是 `ADD` 命令，除非你明确需要 `ADD` 的额外功能。
6. **清理缓存**：在安装软件包后使用 `apt-get clean` 或 `yum clean all` 清理缓存，避免缓存文件被包含进镜像中。
7. **环境变量管理**：使用 `ENV` 指令设置环境变量，便于配置管理和跨构建的复用。
8. **工作目录统一**：尽早使用 `WORKDIR` 指令设置工作目录，并在之后的指令中使用相对路径，保持 Dockerfile 的简洁和清晰。
9. **健康检查**：使用 `HEALTHCHECK` 指令定义健康检查命令，帮助监控容器运行状态，便于自动恢复或告警。
10. **权限控制**：避免使用 `ROOT` 用户运行应用，通过 `USER` 指令切换到非 `ROOT` 用户，提高容器的安全性。
11. **标签管理**：为镜像添加有意义的标签，便于管理和识别不同的镜像版本。
12. **注释**：在 Dockerfile 中适当添加注释，说明各指令的目的和背景，增强可读性和可维护性。
13. **安全性扫描**：定期对构建的镜像进行安全扫描，确保没有已知漏洞。
